<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin.dao.OrderDao">

    <select id="getAllOrder" resultType="admin.vo.Order">
        SELECT a.*, b.name FROM
		(SELECT id, userid, date, '篮球场' type, start_time, end_time, ispay, site_no, iscomplete, alias FROM tb_basketball
		 UNION
		 SELECT id, userid, date, '羽毛球场' type, start_time, end_time, ispay, site_no, iscomplete, alias FROM tb_badminton
		 UNION
		 SELECT id, userid, date, '乒乓球台' type, start_time, end_time, ispay, 0 site_no, iscomplete, alias FROM tb_pingpang) a
		 LEFT JOIN
		(SELECT id, name
		FROM tb_user) b
		ON a.userid = b.id
	    ORDER BY a.date DESC LIMIT #{start}, #{page_size}
    </select>

    <select id="getAllOrderByWechat" resultType="admin.vo.Order">
        SELECT a.*, b.name FROM
		(
             SELECT id, userid, date, '篮球场' type, start_time, end_time, ispay, site_no, iscomplete
             FROM tb_basketball
             <where>
                 <if test="date != null and date != ''">
                     date = #{date}
                 </if>
                 <if test="start_time != 0">
                     AND start_time = #{start_time}
                 </if>
                 <if test="end_time != 0">
                     AND end_time = #{end_time}
                 </if>
             </where>
             UNION
             SELECT id, userid, date, '羽毛球场' type, start_time, end_time, ispay, site_no, iscomplete
             FROM tb_badminton
             <where>
                 <if test="date != null and date != ''">
                    date = #{date}
                 </if>
                 <if test="start_time != 0">
                     AND start_time = #{start_time}
                 </if>
                 <if test="end_time != 0">
                     AND end_time = #{end_time}
                 </if>
             </where>
             UNION
             SELECT id, userid, date, '乒乓球台' type, start_time, end_time, ispay, 0 site_no, iscomplete
             FROM tb_pingpang
             <where>
                 <if test="date != null and date != ''">
                     date = #{date}
                 </if>
                 <if test="start_time != 0">
                    AND start_time = #{start_time}
                 </if>
                 <if test="end_time != 0">
                    AND end_time = #{end_time}
                 </if>
            </where>
		 ) a,
		(
            SELECT id, name
            FROM tb_user
            <where>
                <if test="name != null and name != ''">
                    name = #{name}
                </if>
                <if test="phone != null and phone != ''">
                    and phone = #{phone}
                </if>
            </where>
		) b
		WHERE a.userid = b.id
		ORDER BY a.date DESC LIMIT #{start}, #{page_size}
    </select>

    <select id="getAllOrderUnwechat" resultType="admin.vo.Order">
        SELECT id, userid, date, '篮球场' type, start_time, end_time, ispay, site_no, iscomplete, alias, phone
        FROM tb_basketball
        WHERE alias IS  NOT NULL AND alias != ''
        <if test="alias != null and alias != ''">
            AND alias = #{alias}
        </if>
        <if test="phone != null and phone != ''">
            AND phone = #{phone}
        </if>
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
        UNION
        SELECT id, userid, date, '羽毛球场' type, start_time, end_time, ispay, site_no, iscomplete, alias, phone
        FROM tb_badminton
        WHERE alias IS  NOT NULL AND alias != ''
        <if test="alias != null and alias != ''">
               AND alias = #{alias}
        </if>
        <if test="phone != null and phone != ''">
               AND phone = #{phone}
        </if>
        <if test="date != null and date != ''">
              AND date = #{date}
        </if>
        <if test="start_time != 0">
              AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
              AND end_time = #{end_time}
        </if>
        UNION
        SELECT id, userid, date, '乒乓球台' type, start_time, end_time, ispay, 0 site_no, iscomplete, alias, phone
        FROM tb_pingpang
        WHERE alias IS  NOT NULL AND alias != ''
        <if test="alias != null and alias != ''">
            AND alias = #{alias}
        </if>
        <if test="phone != null and phone != ''">
            AND phone = #{phone}
        </if>
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
    </select>

    <select id="getAllCompleteOrder" resultType="admin.vo.Order">
        SELECT a.*, b.name
        FROM
        (SELECT id, userid, date, '篮球场' type, start_time, end_time, ispay, site_no, iscomplete, alias
          FROM tb_basketball
          WHERE iscomplete = '1'
          <if test="date != null and date != ''">
              AND date = #{date}
          </if>
          <if test="start_time != 0">
              AND start_time = #{start_time}
          </if>
          <if test="end_time != 0">
              AND end_time = #{end_time}
          </if>
		 UNION
		 SELECT id, userid, date, '羽毛球场' type, start_time, end_time, ispay, site_no, iscomplete, alias
         FROM tb_badminton
         WHERE iscomplete = '1'
         <if test="date != null and date != ''">
             AND date = #{date}
         </if>
         <if test="start_time != 0">
             AND start_time = #{start_time}
         </if>
         <if test="end_time != 0">
             AND end_time = #{end_time}
         </if>
		 UNION
		 SELECT id, userid, date, '乒乓球台' type, start_time, end_time, ispay, 0 site_no, iscomplete, alias
         FROM tb_pingpang
         WHERE iscomplete = '1'
         <if test="date != null and date != ''">
             AND date = #{date}
         </if>
         <if test="start_time != 0">
             AND start_time = #{start_time}
         </if>
         <if test="end_time != 0">
             AND end_time = #{end_time}
         </if>
        ) a
        LEFT JOIN
		(SELECT id, name
		  FROM tb_user
          <where>
              <if test="name != null and name != ''">
                  name = #{name}
              </if>
              <if test="phone != null and phone != ''">
                  AND phone = #{phone}
              </if>
          </where>
		) b
        ON a.userid = b.id
        ORDER BY a.date DESC LIMIT #{start}, #{page_size}
    </select>

    <select id="getAllCompleteOrderByWechat" resultType="admin.vo.Order">
        SELECT a.*, b.name FROM
        (
        SELECT id, userid, date, '篮球场' type, start_time, end_time, ispay, site_no, iscomplete
        FROM tb_basketball
        WHERE iscomplete = '1'
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
             AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
        UNION
        SELECT id, userid, date, '羽毛球场' type, start_time, end_time, ispay, site_no, iscomplete
        FROM tb_badminton
        WHERE iscomplete = '1'
        <if test="date != null and date != ''">
              AND date = #{date}
        </if>
        <if test="start_time != 0">
              AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
              AND end_time = #{end_time}
        </if>
        UNION
        SELECT id, userid, date, '乒乓球台' type, start_time, end_time, ispay, 0 site_no, iscomplete
        FROM tb_pingpang
        WHERE iscomplete = '1'
        <if test="date != null and date != ''">
              AND date = #{date}
        </if>
        <if test="start_time != 0">
              AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
              AND end_time = #{end_time}
        </if>
        ) a,
        (
        SELECT id, name
        FROM tb_user
        <where>
            <if test="name != null and name != ''">
                name = #{name}
            </if>
            <if test="phone != null and phone != ''">
                AND phone = #{phone}
            </if>
        </where>
        ) b
        WHERE a.userid = b.id
        ORDER BY a.date DESC LIMIT #{start}, #{page_size}
    </select>

    <select id="getAllCompleteOrderUnwechat" resultType="admin.vo.Order">
        SELECT id, userid, date, '篮球场' type, start_time, end_time, ispay, site_no, iscomplete, alias, phone
        FROM tb_basketball
        WHERE alias IS  NOT NULL AND alias != '' AND iscomplete = '1'
        <if test="alias != null and alias != ''">
            AND alias = #{alias}
        </if>
        <if test="phone != null and phone != ''">
            AND phone = #{phone}
        </if>
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
        UNION
        SELECT id, userid, date, '羽毛球场' type, start_time, end_time, ispay, site_no, iscomplete, alias, phone
        FROM tb_badminton
        WHERE alias IS  NOT NULL AND alias != '' AND iscomplete = '1'
        <if test="alias != null and alias != ''">
            AND alias = #{alias}
        </if>
        <if test="phone != null and phone != ''">
            AND phone = #{phone}
        </if>
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
        UNION
        SELECT id, userid, date, '乒乓球台' type, start_time, end_time, ispay, 0 site_no, iscomplete, alias, phone
        FROM tb_pingpang
        WHERE alias IS  NOT NULL AND alias != '' AND iscomplete = '1'
        <if test="alias != null and alias != ''">
            AND alias = #{alias}
        </if>
        <if test="phone != null and phone != ''">
            AND phone = #{phone}
        </if>
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
    </select>

    <select id="getAllInCompleteOrder" resultType="admin.vo.Order">
        SELECT a.*, b.name
        FROM
        (
            SELECT id, userid, date, '篮球场' type, start_time, end_time, ispay, site_no, iscomplete, alias
            FROM tb_basketball
            WHERE ispay = '1' AND iscomplete = '0'
            <if test="date != null and date != ''">
                AND date = #{date}
            </if>
            <if test="start_time != 0">
                AND start_time = #{start_time}
            </if>
            <if test="end_time != 0">
                AND end_time = #{end_time}
            </if>
            UNION
            SELECT id, userid, date, '羽毛球场' type, start_time, end_time, ispay, site_no, iscomplete, alias
            FROM tb_badminton
            WHERE ispay = '1' AND iscomplete = '0'
            <if test="date != null and date != ''">
                AND date = #{date}
            </if>
            <if test="start_time != 0">
                AND start_time = #{start_time}
            </if>
            <if test="end_time != 0">
                AND end_time = #{end_time}
            </if>
            UNION
            SELECT id, userid, date, '乒乓球台' type, start_time, end_time, ispay, 0 site_no, iscomplete, alias
            FROM tb_pingpang
            WHERE ispay = '1' AND iscomplete = '0'
            <if test="date != null and date != ''">
                AND date = #{date}
            </if>
            <if test="start_time != 0">
                AND start_time = #{start_time}
            </if>
            <if test="end_time != 0">
                AND end_time = #{end_time}
            </if>
        ) a
        LEFT JOIN
        (
            SELECT id, name
            FROM tb_user
            <where>
                <if test="name != null and name != ''">
                    name = #{name}
                </if>
                <if test="phone != null and phone != ''">
                    AND phone = #{phone}
                </if>
            </where>
        ) b
        ON a.userid = b.id
        ORDER BY a.date DESC LIMIT #{start}, #{page_size}
    </select>

    <select id="getAllInCompleteOrderByWechat" resultType="admin.vo.Order">
        SELECT a.*, b.name
        FROM
        (
        SELECT id, userid, date, '篮球场' type, start_time, end_time, ispay, site_no, iscomplete, alias
        FROM tb_basketball
        WHERE ispay = '1' AND iscomplete = '0'
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
        UNION
        SELECT id, userid, date, '羽毛球场' type, start_time, end_time, ispay, site_no, iscomplete, alias
        FROM tb_badminton
        WHERE ispay = '1' AND iscomplete = '0'
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
        UNION
        SELECT id, userid, date, '乒乓球台' type, start_time, end_time, ispay, 0 site_no, iscomplete, alias
        FROM tb_pingpang
        WHERE ispay = '1' AND iscomplete = '0'
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
        ) a,
        (
        SELECT id, name
        FROM tb_user
        <where>
            <if test="name != null and name != ''">
                name = #{name}
            </if>
            <if test="phone != null and phone != ''">
                AND phone = #{phone}
            </if>
        </where>
        ) b
        WHERE a.userid = b.id
        ORDER BY a.date DESC LIMIT #{start}, #{page_size}
    </select>

    <select id="getAllInCompleteOrderUnwechat" resultType="admin.vo.Order">
        SELECT id, userid, date, '篮球场' type, start_time, end_time, ispay, site_no, iscomplete, alias, phone
        FROM tb_basketball
        WHERE alias IS  NOT NULL AND alias != '' AND ispay = '1' AND iscomplete = '0'
        <if test="alias != null and alias != ''">
            AND alias = #{alias}
        </if>
        <if test="phone != null and phone != ''">
            AND phone = #{phone}
        </if>
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
        UNION
        SELECT id, userid, date, '羽毛球场' type, start_time, end_time, ispay, site_no, iscomplete, alias, phone
        FROM tb_badminton
        WHERE alias IS  NOT NULL AND alias != '' AND ispay = '1' AND iscomplete = '0'
        <if test="alias != null and alias != ''">
            AND alias = #{alias}
        </if>
        <if test="phone != null and phone != ''">
            AND phone = #{phone}
        </if>
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
        UNION
        SELECT id, userid, date, '乒乓球台' type, start_time, end_time, ispay, 0 site_no, iscomplete, alias, phone
        FROM tb_pingpang
        WHERE alias IS  NOT NULL AND alias != '' AND ispay = '1' AND iscomplete = '0'
        <if test="alias != null and alias != ''">
            AND alias = #{alias}
        </if>
        <if test="phone != null and phone != ''">
            AND phone = #{phone}
        </if>
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
    </select>

    <select id="getAllUnpayOrder" resultType="admin.vo.Order">
        SELECT a.*, b.name
        FROM
        (
        SELECT id, userid, date, '篮球场' type, start_time, end_time, ispay, site_no, iscomplete, alias
        FROM tb_basketball
        WHERE ispay = '0'
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
        UNION
        SELECT id, userid, date, '羽毛球场' type, start_time, end_time, ispay, site_no, iscomplete, alias
        FROM tb_badminton
        WHERE ispay = '0'
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
        UNION
        SELECT id, userid, date, '乒乓球台' type, start_time, end_time, ispay, 0 site_no, iscomplete, alias
        FROM tb_pingpang
        WHERE ispay = '0'
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
        ) a
        LEFT JOIN
        (
        SELECT id, name
        FROM tb_user
        <where>
            <if test="name != null and name != ''">
                name = #{name}
            </if>
            <if test="phone != null and phone != ''">
                AND phone = #{phone}
            </if>
        </where>
        ) b
        ON a.userid = b.id
        ORDER BY a.date DESC LIMIT #{start}, #{page_size}
    </select>

    <select id="getAllUnpayOrderByWechat" resultType="admin.vo.Order">
        SELECT a.*, b.name
        FROM
        (
        SELECT id, userid, date, '篮球场' type, start_time, end_time, ispay, site_no, iscomplete, alias
        FROM tb_basketball
        WHERE ispay = '0'
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
        UNION
        SELECT id, userid, date, '羽毛球场' type, start_time, end_time, ispay, site_no, iscomplete, alias
        FROM tb_badminton
        WHERE ispay = '0'
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
        UNION
        SELECT id, userid, date, '乒乓球台' type, start_time, end_time, ispay, 0 site_no, iscomplete, alias
        FROM tb_pingpang
        WHERE ispay = '0'
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
        ) a,
        (
        SELECT id, name
        FROM tb_user
        <where>
            <if test="name != null and name != ''">
                name = #{name}
            </if>
            <if test="phone != null and phone != ''">
                AND phone = #{phone}
            </if>
        </where>
        ) b
        WHERE a.userid = b.id
        ORDER BY a.date DESC LIMIT #{start}, #{page_size}
    </select>

    <select id="getAllUnpayOrderUnwechat" resultType="admin.vo.Order">
        SELECT id, userid, date, '篮球场' type, start_time, end_time, ispay, site_no, iscomplete, alias, phone
        FROM tb_basketball
        WHERE alias IS  NOT NULL AND alias != '' AND ispay = '0'
        <if test="alias != null and alias != ''">
            AND alias = #{alias}
        </if>
        <if test="phone != null and phone != ''">
            AND phone = #{phone}
        </if>
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
        UNION
        SELECT id, userid, date, '羽毛球场' type, start_time, end_time, ispay, site_no, iscomplete, alias, phone
        FROM tb_badminton
        WHERE alias IS  NOT NULL AND alias != '' AND ispay = '0'
        <if test="alias != null and alias != ''">
            AND alias = #{alias}
        </if>
        <if test="phone != null and phone != ''">
            AND phone = #{phone}
        </if>
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
        UNION
        SELECT id, userid, date, '乒乓球台' type, start_time, end_time, ispay, 0 site_no, iscomplete, alias, phone
        FROM tb_pingpang
        WHERE alias IS  NOT NULL AND alias != '' AND ispay = '0'
        <if test="alias != null and alias != ''">
            AND alias = #{alias}
        </if>
        <if test="phone != null and phone != ''">
            AND phone = #{phone}
        </if>
        <if test="date != null and date != ''">
            AND date = #{date}
        </if>
        <if test="start_time != 0">
            AND start_time = #{start_time}
        </if>
        <if test="end_time != 0">
            AND end_time = #{end_time}
        </if>
    </select>

</mapper>